{
  "name": "EvaRoomBot (n8n)",
  "settings": {
    "executionTimeout": 900
  },
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message",
          "callback_query"
        ],
        "additionalFields": {}
      },
      "id": "1",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [
        -1420,
        0
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.action}}",
              "operation": "equal",
              "value2": "company"
            }
          ]
        }
      },
      "id": "21",
      "name": "Action is Company",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -80,
        240
      ]
    },
    {
      "parameters": {
        "chatId": "={{$json.chatId}}",
        "text": "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä), —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞.",
        "additionalFields": {}
      },
      "id": "22",
      "name": "Ask Valid INN",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        140,
        360
      ]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "dadataApiUrl",
              "value": "https://suggestions.dadata.ru/suggestions/api/4_1/rs/findById/party"
            },
            {
              "name": "dadataToken",
              "value": "<DADATA_TOKEN>"
            },
            {
              "name": "dadataSecret",
              "value": "<DADATA_SECRET>"
            }
          ]
        },
        "options": {}
      },
      "id": "2",
      "name": "Workflow Configuration",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        -1200,
        0
      ]
    },
    {
      "parameters": {
        "functionCode": "const update = $json;\nconst message = update.message || update.callback_query?.message;\nconst text = update.message?.text || update.callback_query?.data || '';\nconst command = text.startsWith('/') ? text.split(' ')[0] : null;\nconst type = update.callback_query ? 'callback' : command ? 'command' : 'text';\n\nreturn [{\n  json: {\n    ...update,\n    chatId: message?.chat?.id,\n    text,\n    command,\n    callbackData: update.callback_query?.data || null,\n    type,\n  },\n}];\n"
      },
      "id": "3",
      "name": "Router Parse",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -990,
        0
      ]
    },
    {
      "parameters": {
        "functionCode": "const item = items[0];\nconst chatId = item.json.chatId;\nif (!chatId) {\n  return items;\n}\nconst sessions = getWorkflowStaticData('global');\nif (!sessions.store) sessions.store = {};\nif (!sessions.store[chatId]) {\n  sessions.store[chatId] = { state: 'MENU', updatedAt: Date.now() };\n}\nitem.json.session = sessions.store[chatId];\nreturn items;\n"
      },
      "id": "4",
      "name": "Session State",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -780,
        0
      ]
    },
    {
      "parameters": {
        "property": "={{$json.type}}",
        "switches": [
          {
            "value": "command"
          },
          {
            "value": "callback"
          },
          {
            "value": "text"
          }
        ]
      },
      "id": "5",
      "name": "Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        -560,
        0
      ]
    },
    {
      "parameters": {
        "functionCode": "const sessions = getWorkflowStaticData('global');\nconst chatId = $json.chatId;\nif (chatId) {\n  if (!sessions.store) sessions.store = {};\n  sessions.store[chatId] = { state: 'MENU', updatedAt: Date.now() };\n}\nreturn items;\n"
      },
      "id": "6",
      "name": "Handle Commands",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -350,
        -180
      ]
    },
    {
      "parameters": {
        "chatId": "={{$json.chatId}}",
        "text": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ EvaRoomBot! üöÄ\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        "additionalFields": {
          "replyMarkup": "{\n  \"inline_keyboard\": [\n    [\n      { \"text\": \"–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞\", \"callback_data\": \"check_company\" },\n      { \"text\": \"–°–∫–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞\", \"callback_data\": \"score_company\" }\n    ],\n    [\n      { \"text\": \"–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–∑–ª–∏—Ü–∞\", \"callback_data\": \"check_person\" },\n      { \"text\": \"–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞\", \"callback_data\": \"check_contract\" }\n    ],\n    [\n      { \"text\": \"–û –±–æ—Ç–µ\", \"callback_data\": \"about_bot\" }\n    ]\n  ]\n}"
        }
      },
      "id": "7",
      "name": "Send Welcome Menu",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -120,
        -180
      ]
    },
    {
      "parameters": {
        "property": "={{$json.callbackData}}",
        "switches": [
          {
            "value": "check_company"
          },
          {
            "value": "score_company"
          },
          {
            "value": "check_person"
          },
          {
            "value": "check_contract"
          },
          {
            "value": "about_bot"
          }
        ]
      },
      "id": "8",
      "name": "Route Actions",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        -320,
        40
      ]
    },
    {
      "parameters": {
        "functionCode": "const sessions = getWorkflowStaticData('global');\nconst chatId = $json.chatId;\nif (chatId) {\n  if (!sessions.store) sessions.store = {};\n  sessions.store[chatId] = { state: 'WAIT_INN', updatedAt: Date.now(), mode: $json.callbackData };\n}\nreturn items;\n"
      },
      "id": "9",
      "name": "Set WAIT_INN",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -120,
        -40
      ]
    },
    {
      "parameters": {
        "chatId": "={{$json.chatId}}",
        "text": "–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù –∏–ª–∏ –û–ì–†–ù –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏/—Å–∫–æ—Ä–∏–Ω–≥–∞",
        "additionalFields": {}
      },
      "id": "10",
      "name": "Ask INN",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        90,
        -40
      ]
    },
    {
      "parameters": {
        "functionCode": "const sessions = getWorkflowStaticData('global');\nconst chatId = $json.chatId;\nif (chatId) {\n  if (!sessions.store) sessions.store = {};\n  sessions.store[chatId] = { state: 'WAIT_PERSON', updatedAt: Date.now() };\n}\nreturn items;\n"
      },
      "id": "11",
      "name": "Set WAIT_PERSON",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -120,
        120
      ]
    },
    {
      "parameters": {
        "chatId": "={{$json.chatId}}",
        "text": "–í–≤–µ–¥–∏—Ç–µ –§–ò–û, –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –ò–ù–ù (–µ—Å–ª–∏ –µ—Å—Ç—å) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–∑–ª–∏—Ü–∞",
        "additionalFields": {}
      },
      "id": "12",
      "name": "Ask Person Data",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        90,
        120
      ]
    },
    {
      "parameters": {
        "functionCode": "const sessions = getWorkflowStaticData('global');\nconst chatId = $json.chatId;\nif (chatId) {\n  if (!sessions.store) sessions.store = {};\n  sessions.store[chatId] = { state: 'WAIT_CONTRACT', updatedAt: Date.now() };\n}\nreturn items;\n"
      },
      "id": "13",
      "name": "Set WAIT_CONTRACT",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -120,
        270
      ]
    },
    {
      "parameters": {
        "chatId": "={{$json.chatId}}",
        "text": "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–æ–≥–æ–≤–æ—Ä–∞ (–ò–ù–ù, –ö–ü–ü, –ë–ò–ö, —Å—á—ë—Ç) –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏",
        "additionalFields": {}
      },
      "id": "14",
      "name": "Ask Contract Data",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        90,
        270
      ]
    },
    {
      "parameters": {
        "chatId": "={{$json.chatId}}",
        "text": "EvaRoomBot ‚Äî –±–æ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤, —Ñ–∏–∑–ª–∏—Ü –∏ –¥–æ–≥–æ–≤–æ—Ä–æ–≤. –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ n8n, DaData –∏ GPT-4.1.",
        "additionalFields": {}
      },
      "id": "15",
      "name": "Send About",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        90,
        420
      ]
    },
    {
      "parameters": {
        "functionCode": "const item = items[0];\nconst sessions = getWorkflowStaticData('global');\nconst chatId = item.json.chatId;\nconst text = (item.json.text || '').trim();\nif (!chatId || !text) return items;\nconst entry = sessions.store?.[chatId] || { state: 'MENU' };\nconst innLike = /^\d{10,13}$/.test(text);\nitem.json.session = entry;\nitem.json.action = entry.state === 'WAIT_INN' || innLike ? 'company' : 'unknown';\nreturn items;\n"
      },
      "id": "16",
      "name": "Text Router",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        -340,
        240
      ]
    },
    {
      "parameters": {
        "functionCode": "const sessions = getWorkflowStaticData('global');\nconst chatId = $json.chatId;\nif (chatId) {\n  if (!sessions.store) sessions.store = {};\n  sessions.store[chatId] = { state: 'MENU', updatedAt: Date.now() };\n}\nreturn items;\n"
      },
      "id": "17",
      "name": "Reset Session",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        660,
        200
      ]
    },
    {
      "parameters": {
        "url": "={{$node[\"Workflow Configuration\"].json[\"dadataApiUrl\"]}}",
        "method": "POST",
        "authentication": "headerAuth",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "{\n  \"query\": \"={{$json.text}}\"\n}",
        "headerParametersJson": "{\n  \"Authorization\": \"Token {{$node[\\\"Workflow Configuration\\\"].json[\\\"dadataToken\\\"]}}\",\n  \"X-Secret\": \"{{$node[\\\"Workflow Configuration\\\"].json[\\\"dadataSecret\\\"]}}\",\n  \"Content-Type\": \"application/json\"\n}"
      },
      "id": "18",
      "name": "DaData Find Company",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        140,
        570
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "dadata-headers",
          "name": "DaData Headers"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const suggestion = $json.suggestions?.[0]?.data;\nif (!suggestion) {\n  return [{ json: { found: false, message: '‚ùå –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ò–ù–ù/–û–ì–†–ù.' } }];\n}\nlet score = 50;\nconst negatives = [];\nconst positives = [];\nconst years = suggestion.state?.registration_date ? ((Date.now() - new Date(suggestion.state.registration_date).getTime()) / (365*24*60*60*1000)) : null;\nconst clamp = (n) => Math.max(0, Math.min(100, n));\nconst push = (cond, weight, arr, label) => { if (cond) { score += weight; arr.push(label); } };\nconst status = (suggestion.state?.status || '').toUpperCase();\npush(status === 'LIQUIDATING' || status === 'BANKRUPT', -25, negatives, '–°—Ç–∞—Ç—É—Å: –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è/–±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ');\npush(status && !['ACTIVE','LIQUIDATING','BANKRUPT'].includes(status), -10, negatives, `–°—Ç–∞—Ç—É—Å: ${status || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`);\npush(suggestion.state?.invalid === true, -20, negatives, '–ù–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å —Å–≤–µ–¥–µ–Ω–∏–π (–§–ù–°)');\nif (years !== null) {\n  push(years < 1, -15, negatives, '–í–æ–∑—Ä–∞—Å—Ç <1 –≥–æ–¥–∞');\n  push(years >= 1 && years < 3, -5, negatives, '–í–æ–∑—Ä–∞—Å—Ç 1-3 –≥–æ–¥–∞');\n  push(years >= 10 && years < 20, 5, positives, '–í–æ–∑—Ä–∞—Å—Ç 10-20 –ª–µ—Ç');\n  push(years >= 20, 10, positives, '–í–æ–∑—Ä–∞—Å—Ç –±–æ–ª–µ–µ 20 –ª–µ—Ç');\n}\npush(suggestion.is_mass_address, -10, negatives, '–ú–∞—Å—Å–æ–≤—ã–π –∞–¥—Ä–µ—Å');\nconst capital = suggestion.capital?.value || 0;\npush(capital <= 10_000, -5, negatives, '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Å—Ç–∞–≤–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª');\npush(capital >= 1_000_000, 5, positives, '–ö—Ä—É–ø–Ω—ã–π —É—Å—Ç–∞–≤–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª');\npush(capital >= 10_000_000_000, 5, positives, '–°–∏—Å—Ç–µ–º–Ω–æ –∑–Ω–∞—á–∏–º—ã–π –∫–∞–ø–∏—Ç–∞–ª (>10 –º–ª—Ä–¥ ‚ÇΩ)');\nconst employees = suggestion.finance?.employee_count;\npush(typeof employees === 'number' && employees <= 1, -10, negatives, '0-1 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫');\npush(typeof employees === 'number' && employees > 50, 5, positives, '–®—Ç–∞—Ç –±–æ–ª–µ–µ 50 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤');\nconst profit = suggestion.finance?.profit;\npush(typeof profit === 'number' && profit < 0, -5, negatives, '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç');\npush(typeof profit === 'number' && profit > 0, 5, positives, '–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å');\nconst revenue = suggestion.finance?.revenue;\npush(typeof revenue === 'number' && revenue < 1_000_000, -5, negatives, '–ù–∏–∑–∫–∞—è –≤—ã—Ä—É—á–∫–∞ (<1 –º–ª–Ω ‚ÇΩ)');\npush(typeof revenue === 'number' && revenue >= 10_000_000 && revenue < 100_000_000, 3, positives, '–°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ 10-100 –º–ª–Ω ‚ÇΩ');\npush(typeof revenue === 'number' && revenue >= 100_000_000, 5, positives, '–ö—Ä—É–ø–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ (‚â•100 –º–ª–Ω ‚ÇΩ)');\npush(typeof suggestion.finance?.net_asset !== 'undefined' && suggestion.finance.net_asset < 0, -10, negatives, '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å—Ç—ã–µ –∞–∫—Ç–∏–≤—ã');\nif (!negatives.length && status === 'ACTIVE') {\n  push(true, 5, positives, '–ù–µ –≤—ã—è–≤–ª–µ–Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤');\n}\nconst finalScore = clamp(score);\nconst band = [\n  { min:95, level:'–ù–∞–∏–≤—ã—Å—à–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å', recommendation:'–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ–≤–µ—Ä–∏—è.', paymentTerms:'–û—Ç—Å—Ä–æ—á–∫–∞ –¥–æ 60 –¥–Ω–µ–π' },\n  { min:85, level:'–í—ã—Å–æ–∫–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å', recommendation:'–†–∏—Å–∫ –º–∏–Ω–∏–º–∞–ª–µ–Ω, –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –ª—å–≥–æ—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.', paymentTerms:'–û—Ç—Å—Ä–æ—á–∫–∞ –¥–æ 45 –¥–Ω–µ–π' },\n  { min:75, level:'–ù–µ–≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫', recommendation:'–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.', paymentTerms:'–û—Ç—Å—Ä–æ—á–∫–∞ –¥–æ 30 –¥–Ω–µ–π' },\n  { min:65, level:'–£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫', recommendation:'–í–æ–∑–º–æ–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Ä–∞—Å—á—ë—Ç–æ–≤.', paymentTerms:'–û—Ç—Å—Ä–æ—á–∫–∞ –¥–æ 14 –¥–Ω–µ–π' },\n  { min:50, level:'–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫', recommendation:'–î–æ–ø—É—Å—Ç–∏–º–∞ –∫–æ—Ä–æ—Ç–∫–∞—è –æ—Ç—Å—Ä–æ—á–∫–∞ –ø—Ä–∏ —Ç—â–∞—Ç–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–µ.', paymentTerms:'–û—Ç—Å—Ä–æ—á–∫–∞ –¥–æ 7 –¥–Ω–µ–π' },\n  { min:30, level:'–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫', recommendation:'–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã.', paymentTerms:'–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –º–∏–Ω–∏–º—É–º 40%, –æ—Å—Ç–∞—Ç–æ–∫ –¥–æ –æ—Ç–≥—Ä—É–∑–∫–∏' },\n  { min:0, level:'–ö—Ä–∞–π–Ω–µ –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫', recommendation:'–†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ–ª–Ω–æ–π –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–µ.', paymentTerms:'100% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞' }\n].find(b => finalScore >= b.min) || { level:'–ö—Ä–∞–π–Ω–µ –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫', recommendation:'–†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ–ª–Ω–æ–π –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–µ.', paymentTerms:'100% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞' };\nreturn [{ json: {\n  found: true,\n  company: suggestion.name?.full_with_opf || suggestion.name?.short_with_opf,\n  inn: suggestion.inn,\n  ogrn: suggestion.ogrn,\n  score: finalScore,\n  level: band.level,\n  recommendation: band.recommendation,\n  paymentTerms: band.paymentTerms,\n  positives,\n  negatives\n}}];\n"
      },
      "id": "19",
      "name": "Calculate Scoring",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        360,
        570
      ]
    },
    {
      "parameters": {
        "chatId": "={{$json.chatId}}",
        "text": "={{$json.found ? `üìä –°–∫–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞\n–ö–æ–º–ø–∞–Ω–∏—è: ${$json.company || '‚Äî'}\n–ò–ù–ù: ${$json.inn || '‚Äî'}\n–û–ì–†–ù: ${$json.ogrn || '‚Äî'}\n–û—Ü–µ–Ω–∫–∞: ${$json.score} / 100\n–£—Ä–æ–≤–µ–Ω—å: ${$json.level}\n\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: ${$json.recommendation}\n–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã: ${$json.paymentTerms}\n\n‚úÖ –ü–ª—é—Å—ã:\n${($json.positives||[]).join('\\n') || '‚Äî'}\n\n‚ùå –ú–∏–Ω—É—Å—ã:\n${($json.negatives||[]).join('\\n') || '‚Äî'}` : $json.message }}",
        "additionalFields": {}
      },
      "id": "20",
      "name": "Send Scoring Result",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        900,
        570
      ]
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Workflow Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Configuration": {
      "main": [
        [
          {
            "node": "Router Parse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Router Parse": {
      "main": [
        [
          {
            "node": "Session State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Session State": {
      "main": [
        [
          {
            "node": "Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Router": {
      "main": [
        [
          {
            "node": "Handle Commands",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Route Actions",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Text Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle Commands": {
      "main": [
        [
          {
            "node": "Send Welcome Menu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Actions": {
      "main": [
        [
          {
            "node": "Set WAIT_INN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set WAIT_INN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set WAIT_PERSON",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set WAIT_CONTRACT",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send About",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set WAIT_INN": {
      "main": [
        [
          {
            "node": "Ask INN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set WAIT_PERSON": {
      "main": [
        [
          {
            "node": "Ask Person Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set WAIT_CONTRACT": {
      "main": [
        [
          {
            "node": "Ask Contract Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text Router": {
      "main": [
        [
          {
            "node": "Action is Company",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Action is Company": {
      "main": [
        [
          {
            "node": "DaData Find Company",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ask Valid INN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DaData Find Company": {
      "main": [
        [
          {
            "node": "Calculate Scoring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Scoring": {
      "main": [
        [
          {
            "node": "Send Scoring Result",
            "type": "main",
            "index": 0
          },
          {
            "node": "Reset Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "version": 2
}
